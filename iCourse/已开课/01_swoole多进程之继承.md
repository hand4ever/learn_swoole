### swoole 多进程继承

### 背景

> swoole 提供了很方便的多进程继承的扩展功能，我们要首先了解下多进程编程中，子进程从父进程继承了什么，没继承什么，这个对以后的多进程编程会有很大的帮助，也对理解今后的一些问题的出现有帮助

### 概要

- 到底继承了什么
- 父进程和子进程区别
- 在开发中需要注意事项
- 实例讲解

### 知识点

> （摘抄自《UNIX环境高级编程》）

- fork 子进程的特性之一：父进程的所有打开的文件描述符都被复制到子进程中。
- COW(copy-on-write)
- 数据段、代码段、bss、堆栈
- 继承包括
  - 实际用户ID、实际组ID、有效用户ID、有效组ID
  - 附加组ID
  - 进程组ID
  - 会话ID
  - 控制终端
  - 设置用户ID标志和设置组ID标志
  - 当前工作目录
  - 根目录
  - 文件模式创建屏蔽字
  - 信号屏蔽和安排
  - 针对任一打开文件描述符的在执行时关闭（close-on-exec）标志
  - 环境
  - 连接的共享存储段
  - 存储映射
  - 资源限制
- 区别
  - fork的返回值
  - 进程ID不同
  - 两个进程具有不同的父进程ID：子进程的父进程ID是创建它的进程的ID，而父进程的父进程的ID则不变
  - 子进程的tms_utime、tms_stime、tms_cutime以及tms_ustime均被设置为0
  - 父进程设置的文件锁不会被子进程继承
  - 子进程的未处理的闹钟（alarm）被清除
  - 子进程的未处理信号集设置为空集
- 用法
  - 希望复制自己。（父进程等待客户端的服务请求（accept），当这种请求到达时，父进程调用 fork，使子进程处理此请求，父进程则继续等待下一个服务请求到达。）
  - 执行不同程序。（子进程从 fork 返回后立即调用 exec）

### 代码

1. 下载代码 `https://github.com/hand4ever/learn_swoole/tree/master/process/src`
2. `php main.php`



### 下节课

> swoole 多进程在 swoole server  中的体现





（以上）